{"version":3,"sources":["../../src/externalapi/mailgun_send_email.js"],"names":["request","require","querystring","config","apikey","get","domainName","apiUrl","sender","getEmailBody","mail","toAddresses","toAddress","forEach","item","push","stringify","from","to","join","subject","text","content","module","exports","mailDetails","Promise","resolve","reject","rejectUnauthorized","headers","uri","body","method","err","res","statusCode","console","log"],"mappings":"AAAA,MAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,MAAMC,cAAcD,QAAQ,aAAR,CAApB;AACA,MAAME,SAASF,QAAQ,QAAR,CAAf;;AAGA,MAAMG,SAASD,OAAOE,GAAP,CAAW,gBAAX,CAAf;AACA,MAAMC,aAAaH,OAAOE,GAAP,CAAW,oBAAX,CAAnB;AACA,MAAME,SAAU,eAAcH,MAAO,uBAAsBE,UAAW,WAAtE;AACA,MAAME,SAAS,qCAAf;;AAEA,MAAMC,eAAgBC,IAAD,IAAU;AAC3B,QAAIC,cAAc,EAAlB;AACAD,SAAKE,SAAL,CAAeC,OAAf,CAAwBC,IAAD,IAAU;AAC7BH,oBAAYI,IAAZ,CAAiBD,IAAjB;AACH,KAFD;;AAIA,WAAOZ,YAAYc,SAAZ,CAAsB;AACzBC,cAAMT,MADmB;AAEzBU,YAAIP,YAAYQ,IAAZ,CAAiB,GAAjB,CAFqB;AAGzBC,iBAASV,KAAKU,OAHW;AAIzBC,cAAMX,KAAKY;AAJc,KAAtB,CAAP;AAMH,CAZD;;AAcAC,OAAOC,OAAP,GAAiB,UAASC,WAAT,EAAsB;AACnC,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAmB;AAClC5B,gBAAQ;AACJ6B,gCAAoB,KADhB;AAEJC,qBAAS;AACL,gCAAgB;AADX,aAFL;AAKJC,iBAAKxB,MALD;AAMJyB,kBAAMvB,aAAagB,WAAb,CANF;AAOJQ,oBAAQ;AAPJ,SAAR,EAQG,CAACC,GAAD,EAAMC,GAAN,EAAWH,IAAX,KAAkB;AAClB,gBAAG,CAACE,GAAD,IAAQC,IAAIC,UAAJ,KAAmB,GAA9B,EAAkC;AAC9BC,wBAAQC,GAAR,CAAa,yCAAwCN,IAAK,EAA1D;AACAL,wBAAQ,IAAR;AACH,aAHD,MAIK;AACAU,wBAAQC,GAAR,CAAa,uCAAsCH,IAAIC,UAAW,IAAGD,IAAIH,IAAK,EAA9E;AACAL,wBAAQ,KAAR;AACJ;AACH,SAjBD;AAkBH,KAnBM,CAAP;AAoBH,CArBD","file":"mailgun_send_email.js","sourcesContent":["const request = require('request');\r\nconst querystring = require('querystring');\r\nconst config = require('config');\r\n\r\n\r\nconst apikey = config.get('mailgun.apiKey');\r\nconst domainName = config.get('mailgun.domainName'); \r\nconst apiUrl = `https://api:${apikey}@api.mailgun.net/v3/${domainName}/messages`; \r\nconst sender = 'Unique App <ankan.sircar@gmail.com>';\r\n\r\nconst getEmailBody = (mail) => {        \r\n    let toAddresses = [];\r\n    mail.toAddress.forEach((item )=> {\r\n        toAddresses.push(item); \r\n    });\r\n    \r\n    return querystring.stringify({\r\n        from: sender,\r\n        to: toAddresses.join(','),\r\n        subject: mail.subject,\r\n        text: mail.content\r\n    });  \r\n};\r\n\r\nmodule.exports = function(mailDetails) {\r\n    return new Promise((resolve, reject)=>{\r\n        request({\r\n            rejectUnauthorized: false,\r\n            headers: {\r\n                'Content-Type': 'application/x-www-form-urlencoded'\r\n            },\r\n            uri: apiUrl,\r\n            body: getEmailBody(mailDetails),\r\n            method: 'POST'\r\n        }, (err, res, body)=>{            \r\n           if(!err && res.statusCode === 200){\r\n               console.log(`Mailgun request successful. Details : ${body}`);\r\n               resolve(true);\r\n           }\r\n           else {\r\n                console.log(`Mailgun request failed with error : ${res.statusCode} ${res.body}`);\r\n                resolve(false);\r\n           }     \r\n        });\r\n    });    \r\n}"]}