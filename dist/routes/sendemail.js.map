{"version":3,"sources":["../../src/routes/sendemail.js"],"names":["express","require","validateemailrequest","mailgun_send_email","sendgrid_send_email","router","Router","post","req","res","emailRequest","body","validationResult","isValid","statusCode","statusDetails","error","status","send","mailgunResponse","data","sendgridResponse","module","exports"],"mappings":"AAAA,MAAMA,UAAUC,QAAQ,SAAR,CAAhB;AACA,MAAMC,uBAAuBD,QAAQ,oCAAR,CAA7B;AACA,MAAME,qBAAqBF,QAAQ,mCAAR,CAA3B;AACA,MAAMG,sBAAsBH,QAAQ,oCAAR,CAA5B;;AAEA,MAAMI,SAASL,QAAQM,MAAR,EAAf;;AAEAD,OAAOE,IAAP,CAAY,YAAZ,EAA0B,OAAMC,GAAN,EAAWC,GAAX,KAAiB;;AAEvC,UAAMC,eAAeF,IAAIG,IAAzB;AACA,QAAIC,mBAAmB,MAAMV,qBAAqBQ,YAArB,CAA7B;;AAEA,QAAG,CAACE,iBAAiBC,OAArB,EAA8B;AAC1B,YAAIC,aAAa,GAAjB;AACA,YAAIC,gBAAgBH,iBAAiBI,KAArC;AACAP,YAAIQ,MAAJ,CAAWH,UAAX,EAAuBI,IAAvB,CAA4B,EAACJ,UAAD,EAAaC,aAAb,EAA5B;AACH,KAJD,MAKK;AACD,YAAII,kBAAkB,MAAMhB,mBAAmBS,iBAAiBQ,IAApC,CAA5B;;AAEA,YAAGD,eAAH,EAAoB;AAChB,gBAAIL,aAAa,GAAjB;AACA,gBAAIC,gBAAgB,yCAApB;AACAN,gBAAIQ,MAAJ,CAAWH,UAAX,EAAuBI,IAAvB,CAA4B,EAACJ,UAAD,EAAaC,aAAb,EAA5B;AACH,SAJD,MAKK;AACD,gBAAIM,mBAAmBjB,oBAAoBM,YAApB,CAAvB;;AAEA,gBAAGW,gBAAH,EAAqB;AACjB,oBAAIP,aAAa,GAAjB;AACA,oBAAIC,gBAAgB,yCAApB;AACAN,oBAAIQ,MAAJ,CAAWH,UAAX,EAAuBI,IAAvB,CAA4B,EAACJ,UAAD,EAAaC,aAAb,EAA5B;AACH,aAJD,MAKK;AACD,oBAAID,aAAa,GAAjB;AACA,oBAAIC,gBAAgB,6EAApB;AACAN,oBAAIQ,MAAJ,CAAWH,UAAX,EAAuBI,IAAvB,CAA4B,EAACJ,UAAD,EAAaC,aAAb,EAA5B;AACH;AACJ;AACJ;AAEJ,CAlCD;;AAoCAO,OAAOC,OAAP,GAAiBlB,MAAjB","file":"sendemail.js","sourcesContent":["const express = require('express');\r\nconst validateemailrequest = require('../validation/validateemailrequest');\r\nconst mailgun_send_email = require('../externalapi/mailgun_send_email');\r\nconst sendgrid_send_email = require('../externalapi/sendgrid_send_email');\r\n\r\nconst router = express.Router();\r\n\r\nrouter.post('/sendemail', async(req, res)=>{\r\n    \r\n    const emailRequest = req.body;  \r\n    let validationResult = await validateemailrequest(emailRequest);\r\n    \r\n    if(!validationResult.isValid) {\r\n        let statusCode = 400;\r\n        let statusDetails = validationResult.error;\r\n        res.status(statusCode).send({statusCode, statusDetails});   \r\n    }\r\n    else {\r\n        let mailgunResponse = await mailgun_send_email(validationResult.data);\r\n        \r\n        if(mailgunResponse) {\r\n            let statusCode = 202;\r\n            let statusDetails = 'Send email request accepted to process.';\r\n            res.status(statusCode).send({statusCode, statusDetails});\r\n        }\r\n        else {\r\n            let sendgridResponse = sendgrid_send_email(emailRequest);\r\n\r\n            if(sendgridResponse) {\r\n                let statusCode = 202;\r\n                let statusDetails = 'Send email request accepted to process.';\r\n                res.status(statusCode).send({statusCode, statusDetails});    \r\n            }\r\n            else {\r\n                let statusCode = 503;\r\n                let statusDetails = 'Sorry email service is not available at the moment. Please try again later.';\r\n                res.status(statusCode).send({statusCode, statusDetails}); \r\n            }\r\n        }\r\n    }   \r\n\r\n});\r\n\r\nmodule.exports = router;\r\n"]}